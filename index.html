<!DOCTYPE html>
<html>
<head>
  <title>Housing Navigator Agent</title>
  <style>
    html, body {
      font-family: Arial, sans-serif;
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      background-color: #f0f4f9;
    }
    .container {
      text-align: center;
      padding: 40px;
    }
    h1 {
      color: #1a73e8;
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>Housing Navigator Agent</h1>
    <p>Please click the chat icon in the bottom right corner to begin.</p>
  </div>

  <link rel="stylesheet" href="https://www.gstatic.com/dialogflow-console/fast/df-messenger/prod/v1/themes/df-messenger-default.css">
  <script src="https://www.gstatic.com/dialogflow-console/fast/df-messenger/prod/v1/df-messenger.js"></script>
  <df-messenger
    project-id="velasight-housing-agent"
    agent-id="31ac6e23-8d66-4961-b27e-e550586b6604"
    language-code="en"
    max-query-length="-1">
    <df-messenger-chat-bubble
     chat-title="VelasightHousingAgent">
    </df-messenger-chat-bubble>
  </df-messenger>
  <style>
    df-messenger {
      z-index: 999;
      position: fixed;
      --df-messenger-font-color: #000;
      --df-messenger-font-family: Google Sans;
      --df-messenger-chat-background: #f3f6fc;
      --df-messenger-message-user-background: #d3e3fd;
      --df-messenger-message-bot-background: #fff;
      bottom: 16px;
      right: 16px;
    }
  </style>
  <script>
    // Wait for the Dialogflow Messenger component to be ready
    window.addEventListener('df-messenger-loaded', function (event) {
      const dfMessenger = document.querySelector('df-messenger');
      // The shadow DOM contains the chat elements
      const chat = dfMessenger.shadowRoot.querySelector('df-messenger-chat');
      const messageList = chat.shadowRoot.querySelector('.message-list-wrapper');

      // Use a MutationObserver to watch for new messages being added
      const observer = new MutationObserver((mutationsList, observer) => {
        for (const mutation of mutationsList) {
          if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
            mutation.addedNodes.forEach(node => {
              // Check if the new message is from the bot
              if (node.classList && node.classList.contains('bot-message')) {
                const messageText = node.querySelector('.message-text').textContent;
                if (messageText) {
                  // Create a speech utterance and have the browser speak it
                  const utterance = new SpeechSynthesisUtterance(messageText);
                  window.speechSynthesis.speak(utterance);
                }
              }
            });
          }
        }
      });

      // Start observing the message list for changes
      observer.observe(messageList, { childList: true, subtree: true });
    });
  </script>
  </body>
</html>
